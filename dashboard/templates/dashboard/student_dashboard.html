{% extends 'student/base.html' %}
{% block title %}Dashboard - {{ student.ho_ten }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üëã Xin ch√†o, {{ student.ho_ten }}!</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>M√£ sinh vi√™n:</strong> {{ student.ma_sv }}</p>
                        <p><strong>L·ªõp:</strong> {{ student.lop }}</p>
                        <p><strong>Email:</strong> {{ student.email }}</p>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="display-4 text-primary">
                            {% if current_gpa %}
                                {{ current_gpa.gpa }}
                            {% else %}
                                N/A
                            {% endif %}
                        </div>
                        <p class="text-muted">GPA h·ªçc k·ª≥ {{ current_semester }}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ƒêi·ªÉm h·ªçc k·ª≥ hi·ªán t·∫°i -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üìä ƒêi·ªÉm h·ªçc k·ª≥ {{ current_semester }} - {{ current_year }}</h5>
            </div>
            <div class="card-body">
                {% if current_grades %}
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>M√£ m√¥n</th>
                                <th>T√™n m√¥n h·ªçc</th>
                                <th>T√≠n ch·ªâ</th>
                                <th>ƒêi·ªÉm QT</th>
                                <th>ƒêi·ªÉm GK</th>
                                <th>ƒêi·ªÉm CK</th>
                                <th>ƒêi·ªÉm TK</th>
                                <th>ƒêi·ªÉm ch·ªØ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for grade in current_grades %}
                                <tr>
                                    <td>{{ grade.subject.ma_mon }}</td>
                                    <td>{{ grade.subject.ten_mon }}</td>
                                    <td>{{ grade.subject.so_tin_chi }}</td>
                                    <td>{{ grade.diem_qua_trinh|default:"-" }}</td>
                                    <td>{{ grade.diem_giua_ky|default:"-" }}</td>
                                    <td>{{ grade.diem_cuoi_ky|default:"-" }}</td>
                                    <td><strong>{{ grade.diem_tong_ket|default:"-" }}</strong></td>
                                    <td>
                                        <span class="badge 
                                            {% if grade.diem_tong_ket >= 8.5 %}bg-success
                                            {% elif grade.diem_tong_ket >= 7.0 %}bg-primary
                                            {% elif grade.diem_tong_ket >= 5.5 %}bg-warning
                                            {% elif grade.diem_tong_ket >= 4.0 %}bg-secondary
                                            {% else %}bg-danger{% endif %}">
                                            {{ grade.get_letter_grade }}
                                        </span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    {% if current_gpa %}
                        <div class="alert alert-info">
                            <strong>T·ªïng s·ªë t√≠n ch·ªâ:</strong> {{ current_gpa.tong_tin_chi }} | 
                            <strong>T·ªïng ƒëi·ªÉm t√≠ch l≈©y:</strong> {{ current_gpa.tong_diem_tich_luy }}
                        </div>
                    {% endif %}
                {% else %}
                    <p class="text-muted">Ch∆∞a c√≥ ƒëi·ªÉm s·ªë cho h·ªçc k·ª≥ n√†y.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- L·ªãch s·ª≠ GPA -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìà L·ªãch s·ª≠ GPA</h5>
            </div>
            <div class="card-body">
                {% if gpa_history %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>H·ªçc k·ª≥</th>
                                <th>NƒÉm h·ªçc</th>
                                <th>GPA</th>
                                <th>T√≠n ch·ªâ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for gpa_record in gpa_history %}
                                <tr>
                                    <td>HK{{ gpa_record.hoc_ky }}</td>
                                    <td>{{ gpa_record.nam_hoc }}</td>
                                    <td><strong>{{ gpa_record.gpa }}</strong></td>
                                    <td>{{ gpa_record.tong_tin_chi }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="text-muted">Ch∆∞a c√≥ l·ªãch s·ª≠ GPA.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- C√°c l·ªõp h·ªçc -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">üè´ C√°c l·ªõp h·ªçc</h5>
            </div>
            <div class="card-body">
                {% if classes %}
                    <ul class="list-group">
                        {% for class_obj in classes %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ class_obj.ma_lop }}</strong> - {{ class_obj.ten_lop }}
                                    <br>
                                    <small class="text-muted">
                                        GV: {{ class_obj.giao_vien_chu_nhiem.get_full_name|default:class_obj.giao_vien_chu_nhiem.username }}
                                    </small>
                                </div>
                                <span class="badge bg-secondary">{{ class_obj.nam_hoc }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">B·∫°n ch∆∞a thu·ªôc l·ªõp n√†o.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}